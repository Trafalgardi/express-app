let content = '';
let temp = '';

//TODO GRYZ 18 мая 2020
let http = "http://";
let https = "https://";
let header = "";
if (window.location.host == "localhost:3000") {
    header = http;
} else {
    header = https;
}
$.ajax({
    type: "get",
    url: header + window.location.host + '/page/getOpenTests',
    dataType: "json",
    success: function (data) {
        let categories = data.categories;
        let tests = data.tests;
        content = "";
        tests.forEach(test => {
            if (test.category_id === 0) {
                content += addTestsHtml(test);
            }
        });
        categories.forEach(category => {
            content += addCategoriesTestsHtml(category.id, category.name, category.parent_id)
            tests.forEach(test=>{
                if(test.category_id == category.id){
                    content += addTestsHtml(test)
                }
            })
            
        });
        $("#container").append(content);
    },
    error: function (jqXHR, textStatus, errorThrown) {
        alert('error ' + textStatus + " " + errorThrown);
    }
});

function addCategoriesTestsHtml(id, name, parent_id) {
    let content = "";
    if(parent_id!=0){
        content += '<div class="col-12 text-center"><h5>' + name + '</h5></div>';
    }else{
        content += '<div class="col-12 text-center"><h3>' + name + '</h3></div>';
    }
    return content;
}

function addTestsHtml(test) {
    let content = "";
    content += '<div class="col-md-4">'
    content += '    <div class="card mb-4 box-shadow test-item">'
    content += '      <div class="card-img-top text"><p>' + test.name + '</p></div>'
    content += '      <div class="card-body">'
    content += '        <div class="d-flex justify-content-between align-items-center">'
    content += '          <div class="btn-group">'
    content += '            <a  href="./test/' + test.id + '" class="btn btn-sm btn-outline-secondary">Начать</a>'
    content += '          </div>'
    let time = JSON.parse(test.questions).time;
    if (time != 0 && time != undefined)
    content += '          <small class="text-muted">' + (time) + ' мин.</small>'
    content += '        </div>'
    content += '      </div>'
    content += '    </div>'
    content += '</div>'
    return content;
}